/**
 * Created by sgjeon on 16. 4. 5..
 */



// webpack-config module
// https://www.npmjs.com/package/webpack-config
const webpackConfig = require('webpack-config');

// cli options module
// https://www.npmjs.com/package/command-line-args
const commandLineArgs = require('command-line-args');

// path module
const path = require('path');
// lodash module
const _ = require('lodash');

const opts = commandLineArgs([
    {name: 'build', alias: 'b', type: String, defaultOption: false, defaultValue: ['dev']}
]).parse();

var buildConfig = require(path.join(__dirname, '../../../../build.config'));
const toolsConfig = require(path.join(__dirname, '../config'));

// build.config 파일 반환값이 함수 타입일 경우
if (_.isFunction(buildConfig)) buildConfig = buildConfig();

// grunt config object
const config = Object.assign(
    {build: buildConfig},
    {tools: toolsConfig},
	{env: opts.build}
);

// webpack 설정 초기화
webpackConfig.environment.setAll({
    config: config
});

module.exports = new webpackConfig().extend('./webpack.' + opts.build + '.config.js');
