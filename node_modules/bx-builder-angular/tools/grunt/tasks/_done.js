/**
 * Created by sgjeon on 16. 4. 8..
 */

module.exports = function(grunt, options) {

    const gruntConfig = grunt.config;

    const config = grunt.config.get('config');

    // watch 빌드를 위한 done task
    grunt.registerTask('_done', function(){

        var tasks = [];
        const subTask = this.args[0];

        if (subTask === 'dev'){
            tasks = ['htmlbuild', 'shell:userTaskPostDev'];
        }
        else if (subTask === 'prod'){

            tasks = [
                // index.html 파일 빌드
                'htmlbuild',
                // html 파일 압축
                'htmlmin',
                // 마지막에 사용자가 지정한 파일을 실행 한다.
                'shell:userTaskPostProd'
            ];
        }
        else if (subTask === 'watch'){
            tasks = ['htmlbuild'];
        }

        // `hash 파일들은 파일명이 매번 변경되므로, 아래와 같이 해당 `task` 실행 시, 매번 기존 config 내용을 다시 set 해줘야한다.
        grunt.config.set("htmlbuild", require('../dynamic_config/htmlbuild')(grunt));

        grunt.task.run(tasks);
    });
};